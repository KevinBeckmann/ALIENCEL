<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#4caf50">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ALIENCELL">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>Status AssistÃªncia â€” Visual</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
Â  --accent: #4caf50;
Â  --bg-dark: #0f0f0f;
Â  --panel: #161616;
Â  --muted: #bdbdbd;
Â  --text: #e6e6e6;
Â  --scroll-speed: 42s;
}

*{box-sizing:border-box}
html,body{height:100%; margin: 0;}

body{
Â  font-family:"Inter",sans-serif;
Â  background:#1f1f1f;
Â  color:var(--text);
Â  -webkit-font-smoothing:antialiased;
Â  display:flex;
Â  flex-direction:column;
Â  overflow: hidden;
}

.container{
Â  width:100%;
Â  height:100vh;
Â  display:flex;
Â  flex-direction:column;
Â  padding:20px 28px;
Â  overflow: hidden;
}

.button-top{
Â  position:fixed;
Â  top:12px;
Â  font-size:18px;
Â  padding:5px 11px;
Â  color:#b7b7b7;
Â  background:rgba(0,0,0,0.32);
Â  border:1px solid rgba(255,255,255,0.12);
Â  border-radius:8px;
Â  cursor:pointer;
Â  z-index:9999;
Â  transition:0.25s;
Â  backdrop-filter:blur(3px);
}
.button-top:hover{
Â  background:rgba(255,255,255,0.1);
Â  color:white;
}
.fullscreen-btn{ right:12px; }
.admin-btn{ right:54px; }

.header-block{
Â  width:100%;
Â  display:flex;
Â  justify-content:center;
Â  align-items:center;
Â  gap:25px;
Â  flex-shrink: 0;
}
.header-logo{
Â  height:120px;
Â  object-fit:contain;
Â  filter:drop-shadow(0 0 6px rgba(255,255,255,0.25));
}
.header-text{ text-align:center; }
.header-title{ font-size:42px; font-weight:800; margin:0; }
.header-subtitle{ font-size:18px; opacity:.9; margin:0; }

.alerts-full{
Â  width:100%;
Â  background:linear-gradient(180deg,#171717,#121212);
Â  border:1px solid rgba(255,255,255,0.06);
Â  border-radius:14px;
Â  padding:12px 18px;
Â  margin-top:12px;
Â  flex-shrink: 0;
}
.alerts-full h3{
Â  margin:0 0 8px;
Â  color:#ffb3b3;
Â  font-size:18px;
Â  font-weight:600;
}
.alert-empty{ color:var(--muted); font-size: 14px; }

.table-section-title{
Â  width:100%;
Â  text-align:center;
Â  font-size:22px;
Â  font-weight:700;
Â  margin:12px 0 8px 0;
Â  color:#e8e8e8;
Â  flex-shrink: 0;
}

.table-wrapper{
Â  flex:1;
Â  background:linear-gradient(180deg,#0d0d0d,#090909);
Â  border:1px solid rgba(255,255,255,0.06);
Â  border-radius:14px;
Â  padding:14px;
Â  overflow: hidden;
Â  min-height: 0;
}

.scroll-area{
Â  width: 100%;
Â  height: 100%;
Â  overflow: hidden;
Â  position: relative;
Â  scrollbar-width: none;
Â  -ms-overflow-style: none;
}

.scroll-area::-webkit-scrollbar {
Â  display: none;
}

.scroll-inner{
Â  width:100%;
Â  position: relative;
Â  display:block;
Â  background:linear-gradient(180deg,#3a3a3a,#2b2b2b 45%,#1f1f1f);
}

.scroll-area.auto-scroll .scroll-inner{
Â  animation: scrollTable var(--scroll-speed) linear infinite;
Â  will-change: transform;
}

@keyframes scrollTable{
Â  0% { transform: translateY(0); }
Â  100% { transform: translateY(-50%); }
}

table{
Â  width:100%;
Â  border-collapse:collapse;
Â  background:linear-gradient(180deg,#3a3a3a,#2b2b2b 45%,#1f1f1f);
Â  table-layout:fixed;
Â  display:block;
}
thead{
Â  display:table;
Â  width:100%;
Â  table-layout:fixed;
}
tbody{
Â  display:table;
Â  width:100%;
Â  table-layout:fixed;
}
thead th{
Â  padding:18px;
Â  background:linear-gradient(180deg,#545454,#3f3f3f);
Â  font-size:32px;
Â  line-height:38px;
Â  font-weight:800;
Â  color:#fff;
Â  text-align:center;
}

tbody td{
Â  padding:18px;
Â  border-bottom:1px solid rgba(0,0,0,0.25);
Â  color:#e0e0e0;
Â  text-align:center;
Â  font-size:30px;
Â  line-height:38px;
Â  font-weight:700;
}

.status-badge{
Â  display:flex;
Â  justify-content:center;
Â  align-items:center;
Â  padding:14px 28px;
Â  height:64px;
Â  border-radius:9999px;
Â  border:2px solid rgba(255,255,255,0.12);
Â  font-size:28px;
Â  font-weight:800;
Â  white-space:nowrap;
Â  color:#fff;
Â  margin:0 auto;
}

#clone-tabela{
Â  background: transparent !important;
}
#clone-tabela thead{
Â  display: none !important;
}

#promosBox{
Â  width:100%;
Â  background:linear-gradient(180deg,#171717,#121212);
Â  border:1px solid rgba(255,255,255,0.06);
Â  border-radius:14px;
Â  padding:22px 28px;
Â  min-height:80px;
Â  white-space:nowrap;
Â  overflow:hidden;
Â  margin-top:12px;
Â  flex-shrink: 0;
}

#promosText{
Â  font-size:32px;
Â  line-height:40px;
Â  font-weight:800;
Â  color:#ffffff;
Â  display:inline-block;
Â  padding-left:100%;
Â  animation: slidePromo 14s linear infinite;
}

@keyframes slidePromo{
Â  from{ transform:translateX(0%); }
Â  to{ transform:translateX(-100%); }
}

.scroll-area, .scroll-inner, table {
Â  -webkit-user-select: none;
Â  user-select: none;
}
</style>
</head>
<body>

<button class="button-top fullscreen-btn" id="fullButton">â›¶</button>
<button class="button-top admin-btn" id="adminButton">ðŸ‘¤</button>

<div class="container">

Â  <div class="header-block">
Â  Â  <img src="imageem.png" class="header-logo">
Â  Â  <div class="header-text">
Â  Â  Â  <h1 class="header-title">ALIENCELL</h1>
Â  Â  Â  <div class="header-subtitle">Reparos avanÃ§ados Apple</div>
Â  Â  </div>
Â  </div>

Â  <div class="alerts-full">
Â  Â  <h3>AtenÃ§Ã£o para as seguintes O.S.</h3>
Â  Â  <div id="alerts-list">
Â  Â  Â  <div class="alert-empty">Nenhum alerta no momento.</div>
Â  Â  </div>
Â  </div>

Â  <div class="table-section-title">Status de ServiÃ§o</div>

Â  <div class="table-wrapper scroll-area" id="scrollArea">
Â  Â  <table id="tabelaStatus">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th>Cliente</th>
Â  Â  Â  Â  Â  <th>Status</th>
Â  Â  Â  Â  Â  <th>PrevisÃ£o</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>

Â  <div id="promosBox">
Â  Â  <span id="promosText"></span>
Â  </div>

</div>

<script>
if ('serviceWorker' in navigator) {
Â  window.addEventListener('load', () => {
Â  Â  navigator.serviceWorker.register('sw.js') 
Â  Â  Â  .then(reg => console.log('Service Worker registrado'))
Â  Â  Â  .catch(err => console.log('Erro no Service Worker:', err));
Â  });
}

document.getElementById("fullButton").addEventListener("click",()=>{
Â  if(!document.fullscreenElement){
Â  Â  document.documentElement.requestFullscreen();
Â  }else{
Â  Â  document.exitFullscreen();
Â  }
});

document.getElementById("adminButton").addEventListener("click", () => {
Â  window.location.href = "administrador.html";
});

const STORAGE_KEY = "assist_db";

function getDB(){
Â  const raw = localStorage.getItem(STORAGE_KEY);
Â  if(!raw) return { tabela: [], promocoes: "" };
Â  try{ return JSON.parse(raw); }
Â  catch{ return { tabela: [], promocoes: "" }; }
}
function getTabela(){ return getDB().tabela || []; }
function getPromocoes(){ return getDB().promocoes || ""; }

const statusColors = {
Â  "AnÃ¡lise/DiagnÃ³stico": "rgba(154,160,166,0.55)",
Â  "Aguardando AprovaÃ§Ã£o": "rgba(241,196,15,0.55)",
Â  "Aguardando PeÃ§a": "rgba(230,126,34,0.55)",
Â  "Em Reparo": "rgba(52,152,219,0.55)",
Â  "Pronto para Retirada": "rgba(46,204,113,0.55)"
};

function escapeHtml(s){
Â  return (s+"").replace(/[&<>"']/g,c=>({
Â  Â  '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"
Â  }[c]));
}

function carregarTabela(){
Â  const tbody=document.querySelector("#tabelaStatus tbody");
Â  const dados=getTabela();
Â  tbody.innerHTML="";

Â  if(dados.length===0){
Â  Â  tbody.innerHTML=`<tr><td colspan="3" style="text-align:center;color:#bbb;padding:20px">
Â  Â  Â  Nenhum serviÃ§o lanÃ§ado.
Â  Â  </td></tr>`;
Â  Â  limparScrollWrapper();
Â  Â  return;
Â  }

Â  dados.forEach(item=>{
Â  Â  const cor=statusColors[item.status]||"#999";
Â  Â  const tr=document.createElement("tr");
Â  Â  tr.innerHTML=`
Â  Â  Â  <td>${escapeHtml(item.cliente)}</td>
Â  Â  Â  <td><span class="status-badge" style="background:${cor}">${escapeHtml(item.status)}</span></td>
Â  Â  Â  <td>${escapeHtml(item.previsao)}</td>
Â  Â  `;
Â  Â  tbody.appendChild(tr);
Â  });

Â  atualizarAlertsUI();
Â  ativarScrollSeNecessario(dados.length);
}

function limparScrollWrapper(){
Â  const area = document.getElementById("scrollArea");
Â  area.classList.remove("auto-scroll");
Â  const inner = area.querySelector(".scroll-inner");
Â  if(inner){
Â  Â  const tabela = inner.querySelector("#tabelaStatus");
Â  Â  if(tabela){
Â  Â  Â  area.appendChild(tabela);
Â  Â  }
Â  Â  inner.remove();
Â  }
Â  const clone = document.getElementById("clone-tabela");
Â  if(clone) clone.remove();
}

function ativarScrollSeNecessario(qtd){
Â  const area = document.getElementById("scrollArea");

Â  area.classList.remove("auto-scroll");
Â  const oldClone = document.getElementById("clone-tabela");
Â  if(oldClone) oldClone.remove();
Â  const oldInner = area.querySelector(".scroll-inner");
Â  if(oldInner){
Â  Â  const existingTable = oldInner.querySelector("#tabelaStatus");
Â  Â  if(existingTable){
Â  Â  Â  area.appendChild(existingTable);
Â  Â  }
Â  Â  oldInner.remove();
Â  }

Â  if(qtd < 7){
Â  Â  return;
Â  }

Â  const inner = document.createElement("div");
Â  inner.className = "scroll-inner";

Â  const tabela = document.querySelector("#tabelaStatus");
Â  if(!tabela) return;
Â  area.appendChild(inner);
Â  inner.appendChild(tabela);

Â  const clone = tabela.cloneNode(true);
Â  clone.id = "clone-tabela";

Â  const thead = clone.querySelector("thead");
Â  if(thead) thead.remove();

Â  const elemsWithId = clone.querySelectorAll("[id]");
Â  elemsWithId.forEach(e => {
Â  Â  if(e.id === "tabelaStatus") e.id = "";
Â  });

Â  inner.appendChild(clone);

Â  requestAnimationFrame(() => {
Â  Â  area.classList.add("auto-scroll");
Â  });
}

function parseTimeHHMM(t){
Â  const m=String(t).match(/^([0-2][0-9]):([0-5][0-9])$/);
Â  if(!m) return null;
Â  const now=new Date();
Â  const d=new Date(now.getFullYear(),now.getMonth(),now.getDate(),parseInt(m[1]),parseInt(m[2]));
Â  if(d < now - 60000) d.setDate(d.getDate()+1);
Â  return d;
}

function minutesDiff(a,b){ return (b-a)/60000; }

function atualizarAlertsUI(){
Â  const lista = getTabela();
Â  const box = document.getElementById("alerts-list");
Â  box.innerHTML = "";
Â  const now = new Date();
Â  const arr = [];

Â  lista.forEach(item=>{
Â  Â  const t = parseTimeHHMM(item.previsao);
Â  Â  if(!t) return;
Â  Â  const m = minutesDiff(now,t);
Â  Â  if(m>=0 && m<=5) arr.push({item,m});
Â  });

Â  if(arr.length===0){
Â  Â  box.innerHTML = `<div class="alert-empty">Nenhum alerta no momento.</div>`;
Â  Â  return;
Â  }

Â  arr.sort((a,b)=>a.m-b.m);

Â  arr.forEach(a=>{
Â  Â  const div = document.createElement("div");
Â  Â  div.className = "alert-item";
Â  Â  div.innerHTML = `
Â  Â  Â  <div style="font-weight:700">${escapeHtml(a.item.cliente)}</div>
Â  Â  Â  <div style="text-align:right">
Â  Â  Â  Â  <div class="alert-time">${escapeHtml(a.item.previsao)}</div>
Â  Â  Â  Â  <div style="font-size:13px;color:#ffdede">${Math.ceil(a.m)} min</div>
Â  Â  Â  </div>
Â  Â  `;
Â  Â  box.appendChild(div);
Â  });
}

function carregarPromocoes(){
Â  document.getElementById("promosText").textContent=getPromocoes();
}

function refreshAll(){
Â  carregarTabela();
Â  carregarPromocoes();
Â  atualizarAlertsUI();
}

let lastRaw=localStorage.getItem(STORAGE_KEY);
setInterval(()=>{
Â  const nowRaw=localStorage.getItem(STORAGE_KEY);
Â  if(nowRaw!==lastRaw){
Â  Â  lastRaw=nowRaw;
Â  Â  refreshAll();
Â  }
},900);

document.addEventListener("DOMContentLoaded",()=>{
Â  refreshAll();
});
</script>

</body>
</html>
