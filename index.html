<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Status AssistÃªncia â€” Visual</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
Â  --accent: #4caf50;
Â  --bg-dark: #0f0f0f;
Â  --panel: #161616;
Â  --muted: #bdbdbd;
Â  --text: #e6e6e6;

Â  /* velocidade de rolagem */
Â  --scroll-speed: 42s;
}

*{box-sizing:border-box}
html,body{height:100%;}

body{
Â  margin:0;
Â  font-family:"Inter",sans-serif;
Â  background: linear-gradient(180deg,#000000,#131313,#1c1c1c);
Â  color:var(--text);
Â  -webkit-font-smoothing:antialiased;
Â  display:flex;
Â  flex-direction:column;
Â  min-height:100vh;
}

.container{
Â  width:100%;
Â  flex:1;
Â  display:flex;
Â  flex-direction:column;
Â  padding:20px 28px;
}

/* BOTÃ•ES SUPERIORES */
.button-top{
Â  position:fixed;
Â  top:12px;
Â  font-size:18px;
Â  padding:5px 11px;
Â  color:#b7b7b7;
Â  background:rgba(0,0,0,0.32);
Â  border:1px solid rgba(255,255,255,0.12);
Â  border-radius:8px;
Â  cursor:pointer;
Â  z-index:9999;
Â  transition:0.25s;
Â  backdrop-filter:blur(3px);
}
.button-top:hover{
Â  background:rgba(255,255,255,0.1);
Â  color:white;
}
.fullscreen-btn{ right:12px; }
.admin-btn{ right:54px; }

/* HEADER */
.header-block{
Â  width:100%;
Â  display:flex;
Â  justify-content:center;
Â  align-items:center;
Â  margin-bottom:25px;
Â  gap:25px;
Â  margin-left:-40px;
}
.header-logo{
Â  height:150px;
Â  object-fit:contain;
Â  filter:drop-shadow(0 0 6px rgba(255,255,255,0.25));
}
.header-text{ text-align:center; }
.header-title{ font-size:48px; font-weight:800; margin:0; }
.header-subtitle{ font-size:22px; opacity:.9; margin:0; }

/* ALERTA FULL WIDTH */
.alerts-full{
Â  width:100%;
Â  background:linear-gradient(180deg,#171717,#121212);
Â  border:1px solid rgba(255,255,255,0.06);
Â  border-radius:14px;
Â  padding:14px 18px;
Â  margin-bottom:20px;
}
.alerts-full h3{
Â  margin:0 0 10px;
Â  color:#ffb3b3;
Â  font-size:20px;
Â  font-weight:600;
}
.alert-empty{ color:var(--muted); }

/* TÃTULO ENTRE ALERTAS E TABELA */
.table-section-title{
Â  width:100%;
Â  text-align:center;
Â  font-size:26px;
Â  font-weight:700;
Â  margin:10px 0 10px 0;
Â  color:#e8e8e8;
}

/* TABELA */
.table-wrapper{
Â  flex:1;
Â  background:linear-gradient(180deg,#0d0d0d,#090909);
Â  border:1px solid rgba(255,255,255,0.06);
Â  border-radius:14px;
Â  padding:14px;
Â  margin-top:10px;
}

/* SCROLL AUTOMÃTICO */
.scroll-area{
Â  max-height: calc(100vh - 320px);
Â  overflow: hidden;
Â  position: relative;
}

.scroll-area.auto-scroll table{
Â  /* A tabela principal rola para cima (inÃ­cio da animaÃ§Ã£o) */
Â  animation: scrollTable var(--scroll-speed) linear infinite;
}

@keyframes scrollTable{
Â  0% { transform: translateY(0); }
Â  100% { transform: translateY(-50%); }
}

table{
Â  width:100%;
Â  border-collapse:collapse;
Â  /* Fundo principal da tabela */
Â  background:linear-gradient(180deg,#3a3a3a,#2b2b2b 45%,#1f1f1f);
}

/* A tabela clone tambÃ©m usarÃ¡ o fundo principal */
#clone-tabela {
Â  /* Garante que o fundo nÃ£o mude */
Â  background: inherit !important; 
}

thead th{
Â  padding:18px;
Â  background:linear-gradient(180deg,#545454,#3f3f3f);
Â  font-size:26px;
Â  line-height:32px;
Â  font-weight:700;
Â  color:#fff;
Â  text-align:center;
}
tbody td{
Â  padding:18px;
Â  border-bottom:1px solid rgba(0,0,0,0.25);
Â  color:#e0e0e0;
Â  text-align:center;
Â  font-size:26px;
Â  line-height:34px;
Â  font-weight:600;
}

.status-badge{
Â  display:flex;
Â  justify-content:center;
Â  align-items:center;
Â  padding:14px 24px;
Â  height:60px;
Â  border-radius:9999px;
Â  border:2px solid rgba(255,255,255,0.12);
Â  font-size:26px;
Â  font-weight:700;
Â  white-space:nowrap;
Â  color:#fff;
Â  margin:0 auto;
}

/* PROMOÃ‡Ã•ES */
#promosBox{
Â  width:100%;
Â  background:linear-gradient(180deg,#171717,#121212);
Â  border:1px solid rgba(255,255,255,0.06);
Â  border-radius:12px;
Â  padding:18px 20px;
Â  white-space:nowrap;
Â  overflow:hidden;
}
#promosText{
Â  font-size:28px;
Â  line-height:34px;
Â  font-weight:700;
Â  color:#dcdcdc;
Â  display:inline-block;
Â  padding-left:100%;
Â  animation: slidePromo 14s linear infinite;
}

@keyframes slidePromo{
Â  from{ transform:translateX(0%); }
Â  to{ transform:translateX(-100%); }
}
</style>
</head>
<body>

<button class="button-top fullscreen-btn" id="fullButton">â›¶</button>
<button class="button-top admin-btn" id="adminButton">ğŸ‘¤</button>

<div class="container">

Â  Â  <div class="header-block">
Â  Â  <img src="imageem.png" class="header-logo">
Â  Â  <div class="header-text">
Â  Â  Â  <h1 class="header-title">ALIENCELL</h1>
Â  Â  Â  <div class="header-subtitle">Reparos avanÃ§ados Apple</div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="alerts-full">
Â  Â  <h3>AtenÃ§Ã£o para as seguintes O.S.</h3>
Â  Â  <div id="alerts-list">
Â  Â  Â  <div class="alert-empty">Nenhum alerta no momento.</div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="table-section-title">Status de ServiÃ§o</div>

Â  Â  <div class="table-wrapper scroll-area" id="scrollArea">
Â  Â  <table id="tabelaStatus">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th>Cliente</th>
Â  Â  Â  Â  Â  <th>Status</th>
Â  Â  Â  Â  Â  <th>PrevisÃ£o</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>

Â  Â  <div id="promosBox">
Â  Â  <span id="promosText"></span>
Â  </div>

</div>

<script>
/* FULLSCREEN */
document.getElementById("fullButton").addEventListener("click",()=>{
Â  if(!document.fullscreenElement){
Â  Â  document.documentElement.requestFullscreen();
Â  }else{
Â  Â  document.exitFullscreen();
Â  }
});

/* ADMIN */
document.getElementById("adminButton").addEventListener("click", () => {
Â  window.location.href = "administrador.html";
});

/* BANCO */
const STORAGE_KEY = "assist_db";

function getDB(){
Â  const raw = localStorage.getItem(STORAGE_KEY);
Â  if(!raw) return { tabela: [], promocoes: "" };
Â  try{ return JSON.parse(raw); }
Â  catch{ return { tabela: [], promocoes: "" }; }
}
function getTabela(){ return getDB().tabela || []; }
function getPromocoes(){ return getDB().promocoes || ""; }

const statusColors = {
Â  "AnÃ¡lise/DiagnÃ³stico": "rgba(154,160,166,0.55)",
Â  "Aguardando AprovaÃ§Ã£o": "rgba(241,196,15,0.55)",
Â  "Aguardando PeÃ§a": "rgba(230,126,34,0.55)",
Â  "Em Reparo": "rgba(52,152,219,0.55)",
Â  "Pronto para Retirada": "rgba(46,204,113,0.55)"
};

function escapeHtml(s){
Â  return (s+"").replace(/[&<>"']/g,c=>({
Â  Â  '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"
Â  }[c]));
}

/* TABELA */
function carregarTabela(){
Â  const tbody=document.querySelector("#tabelaStatus tbody");
Â  const dados=getTabela();
Â  tbody.innerHTML="";

Â  if(dados.length===0){
Â  Â  tbody.innerHTML=`<tr><td colspan="3" style="text-align:center;color:#bbb;padding:20px">
Â  Â  Â  Nenhum serviÃ§o lanÃ§ado.
Â  Â  </td></tr>`;
Â  Â  return;
Â  }

Â  dados.forEach(item=>{
Â  Â  const cor=statusColors[item.status]||"#999";
Â  Â  const tr=document.createElement("tr");
Â  Â  tr.innerHTML=`
Â  Â  Â  <td>${escapeHtml(item.cliente)}</td>
Â  Â  Â  <td><span class="status-badge" style="background:${cor}">${escapeHtml(item.status)}</span></td>
Â  Â  Â  <td>${escapeHtml(item.previsao)}</td>
Â  Â  `;
Â  Â  tbody.appendChild(tr);
Â  });

Â  atualizarAlertsUI();
Â  ativarScrollSeNecessario(dados.length);
}

/* SCROLL AUTOMÃTICO CORRIGIDO */
function ativarScrollSeNecessario(qtd){
Â  const area = document.getElementById("scrollArea");
Â  const tabela = document.getElementById("tabelaStatus");

Â  // 1. Limpa o estado anterior
Â  area.classList.remove("auto-scroll");
Â  const oldClone = document.getElementById("clone-tabela");
Â  if(oldClone) oldClone.remove();

Â  // 2. Verifica se a rolagem automÃ¡tica Ã© necessÃ¡ria
Â  if(qtd >= 7){
Â  Â  area.classList.add("auto-scroll");

Â  Â  // 3. Cria a nova tabela clone
Â  Â  const clone = document.createElement("table");
Â  Â  clone.id = "clone-tabela";

Â  Â  // 4. Clona apenas o corpo (tbody) para evitar a duplicaÃ§Ã£o do cabeÃ§alho (thead)
Â  Â  const tbody = tabela.querySelector("tbody");
Â  Â  if (tbody) {
Â  Â  Â  clone.appendChild(tbody.cloneNode(true));
Â  Â  }

Â  Â  // 5. Aplica os estilos necessÃ¡rios para o posicionamento e animaÃ§Ã£o
Â  Â  tabela.style.tableLayout = "fixed"; 

Â  Â  clone.style.tableLayout = "fixed";
Â  Â  clone.style.position = "absolute";
Â  Â  
Â  Â  // CORREÃ‡ÃƒO PRINCIPAL: Subtrair 1px para sobrepor a borda do Ãºltimo elemento, eliminando o espaÃ§o.
Â  Â  clone.style.top = (tabela.offsetHeight - 1) + "px"; 
Â  Â  
Â  Â  clone.style.left = "0";
Â  Â  clone.style.width = "100%";
Â  Â  
Â  Â  // 6. Insere o clone
Â  Â  area.appendChild(clone);
Â  }
}

/* ALERTAS */
function parseTimeHHMM(t){
Â  const m=String(t).match(/^([0-2][0-9]):([0-5][0-9])$/);
Â  if(!m) return null;
Â  const now=new Date();
Â  const d=new Date(now.getFullYear(),now.getMonth(),now.getDate(),parseInt(m[1]),parseInt(m[2]));
Â  if(d < now - 60000) d.setDate(d.getDate()+1);
Â  return d;
}

function minutesDiff(a,b){ return (b-a)/60000; }

function atualizarAlertsUI(){
Â  const lista=getTabela();
Â  const box=document.getElementById("alerts-list");
Â  box.innerHTML="";
Â  const now=new Date();
Â  const arr=[];

Â  lista.forEach(item=>{
Â  Â  const t=parseTimeHHMM(item.previsao);
Â  Â  if(!t) return;
Â  Â  const m=minutesDiff(now,t);
Â  Â  if(m>=0 && m<=5) arr.push({item,m});
Â  });

Â  if(arr.length===0){
Â  Â  box.innerHTML=`<div class="alert-empty">Nenhum alerta no momento.</div>`;
Â  Â  return;
Â  }

Â  arr.sort((a,b)=>a.m-b.m);

Â  arr.forEach(a=>{
Â  Â  const div=document.createElement("div");
Â  Â  div.className="alert-item";
Â  Â  div.innerHTML=`
Â  Â  Â  <div style="font-weight:700">${escapeHtml(a.item.cliente)}</div>
Â  Â  Â  <div style="text-align:right">
Â  Â  Â  Â  <div class="alert-time">${escapeHtml(a.item.previsao)}</div>
Â  Â  Â  Â  <div style="font-size:13px;color:#ffdede">${Math.ceil(a.m)} min</div>
Â  Â  Â  </div>
Â  Â  `;
Â  Â  box.appendChild(div);
Â  });
}

/* PROMOÃ‡Ã•ES */
function carregarPromocoes(){
Â  document.getElementById("promosText").textContent=getPromocoes();
}

/* REFRESH */
function refreshAll(){
Â  carregarTabela();
Â  carregarPromocoes();
Â  atualizarAlertsUI();
}

let lastRaw=localStorage.getItem(STORAGE_KEY);
setInterval(()=>{
Â  const nowRaw=localStorage.getItem(STORAGE_KEY);
Â  if(nowRaw!==lastRaw){
Â  Â  lastRaw=nowRaw;
Â  Â  refreshAll();
Â  }
},900);

document.addEventListener("DOMContentLoaded",()=>{
Â  refreshAll();
});
</script>

</body>
</html>
